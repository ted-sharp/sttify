<Window x:Class="Sttify.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Sttify Settings"
        Width="600" Height="500"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize">
    
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Title -->
        <TextBlock Grid.Row="0" 
                   Text="Sttify Settings" 
                   FontSize="18" 
                   FontWeight="Bold" 
                   Margin="0,0,0,10"/>
        
        <!-- Settings Tabs -->
        <TabControl Grid.Row="1">
            <TabItem Header="General">
                <StackPanel Margin="10">
                    <CheckBox Content="Start with Windows" 
                             IsChecked="{Binding Settings.Application.StartWithWindows}" 
                             Margin="0,5"/>
                    <CheckBox Content="Show in system tray" 
                             IsChecked="{Binding Settings.Application.ShowInTray}" 
                             Margin="0,5"/>
                    <CheckBox Content="Start minimized" 
                             IsChecked="{Binding Settings.Application.StartMinimized}" 
                             Margin="0,5"/>
                </StackPanel>
            </TabItem>
            
            <TabItem Header="Audio">
                <StackPanel Margin="10">
                    <Label Content="Audio Device:"/>
                    <ComboBox ItemsSource="{Binding AudioDevices}"
                             DisplayMemberPath="Name"
                             SelectedValuePath="Id"
                             SelectedValue="{Binding Settings.Audio.DeviceId}"
                             Margin="0,5,0,10"/>
                    
                    <Label Content="Sample Rate:"/>
                    <ComboBox Margin="0,5,0,10">
                        <ComboBoxItem Content="16000 Hz" IsSelected="True"/>
                        <ComboBoxItem Content="22050 Hz"/>
                        <ComboBoxItem Content="44100 Hz"/>
                    </ComboBox>
                </StackPanel>
            </TabItem>
            
            <TabItem Header="Engine">
                <StackPanel Margin="10">
                    <Grid Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Label Grid.Column="0" Content="STT Engine:" VerticalAlignment="Center"/>
                        <ComboBox Grid.Column="1" ItemsSource="{Binding AvailableEngines}"
                                 SelectedItem="{Binding Settings.Engine.Profile}"
                                 Margin="5,0,5,0" VerticalAlignment="Center"/>
                        <Button Grid.Column="2" Content="📦 Models" 
                               Command="{Binding ShowVoskModelInfoCommand}"
                               Width="70" VerticalAlignment="Center" Margin="0,0,5,0"
                               ToolTip="Show Vosk model download information"
                               Visibility="{Binding IsVoskSelected, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        <Button Grid.Column="3" Content="📖 Docs" 
                               Command="{Binding OpenEngineDocumentationCommand}"
                               Width="60" VerticalAlignment="Center"
                               ToolTip="Open official documentation"/>
                    </Grid>
                    
                    <Label Content="Vosk Model Path:"/>
                    <Grid Margin="0,5,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0" Text="{Binding Settings.Engine.Vosk.ModelPath}"/>
                        <Button Grid.Column="1" Content="Browse..." 
                               Command="{Binding BrowseForModelCommand}" 
                               Width="80" Margin="5,0,0,0"/>
                    </Grid>
                    
                    <CheckBox Content="Enable punctuation" 
                             IsChecked="{Binding Settings.Engine.Vosk.Punctuation}" 
                             Margin="0,5"/>
                    
                    <!-- Vibe Configuration -->
                    <GroupBox Header="Vibe Configuration" Margin="0,15,0,0"
                             Visibility="{Binding IsVibeEngine, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <StackPanel Margin="10">
                            <Label Content="Vibe Endpoint:"/>
                            <TextBox Text="{Binding Settings.Engine.Vibe.Endpoint}" Margin="0,5,0,10"/>
                            <TextBlock Text="URL of the Vibe HTTP API server (e.g., http://localhost:8080)"
                                      Foreground="Gray" FontSize="11" Margin="0,0,0,10"/>
                            
                            <Label Content="API Key (optional):"/>
                            <TextBox Text="{Binding Settings.Engine.Vibe.ApiKey}" Margin="0,5,0,10"/>
                            
                            <Label Content="Language:"/>
                            <ComboBox SelectedValue="{Binding Settings.Engine.Vibe.Language}" Margin="0,5,0,10">
                                <ComboBoxItem Content="Auto Detect" Tag=""/>
                                <ComboBoxItem Content="Japanese (ja)" Tag="ja"/>
                                <ComboBoxItem Content="English (en)" Tag="en"/>
                                <ComboBoxItem Content="Chinese (zh)" Tag="zh"/>
                            </ComboBox>
                            
                            <CheckBox Content="Enable diarization (speaker separation)" 
                                     IsChecked="{Binding Settings.Engine.Vibe.EnableDiarization}" 
                                     Margin="0,5"/>
                            <CheckBox Content="Enable post-processing" 
                                     IsChecked="{Binding Settings.Engine.Vibe.EnablePostProcessing}" 
                                     Margin="0,5"/>
                            
                            <Button Content="Test Connection" 
                                   Command="{Binding TestVibeCommand}"
                                   Width="120" HorizontalAlignment="Left" Margin="0,10,0,0"/>
                        </StackPanel>
                    </GroupBox>
                </StackPanel>
            </TabItem>
            
            <TabItem Header="Output">
                <StackPanel Margin="10">
                    <Label Content="Primary Output:"/>
                    <ComboBox SelectedIndex="{Binding Settings.Output.PrimaryOutputIndex}" 
                             Margin="0,5,0,10">
                        <ComboBoxItem Content="TSF Text Input Processor"/>
                        <ComboBoxItem Content="SendInput"/>
                        <ComboBoxItem Content="External Process"/>
                    </ComboBox>
                    
                    <CheckBox Content="Suppress when IME is composing" 
                             IsChecked="{Binding Settings.Output.Tsf.SuppressWhenImeComposing}" 
                             Margin="0,5,0,15"/>
                    
                    <!-- Test Section -->
                    <GroupBox Header="Output Test" Margin="0,0,0,15">
                        <StackPanel Margin="10">
                            <TextBlock Text="Test output methods using global keyboard shortcuts (works from any application):" 
                                      Margin="0,0,0,10" TextWrapping="Wrap"/>
                            <TextBox x:Name="TestTextBox" Text="Hello, this is a test from Sttify." 
                                    Margin="0,0,0,10"/>
                            
                            <Grid Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Win+Shift+F1:" FontWeight="Bold" Margin="0,2,10,2"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="Test currently selected output method" Margin="0,2"/>
                                
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Win+Shift+F2:" FontWeight="Bold" Margin="0,2,10,2"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="Test TSF TIP (direct text insertion)" Margin="0,2"/>
                                
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Win+Shift+F3:" FontWeight="Bold" Margin="0,2,10,2"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="Test SendInput (virtual keyboard)" Margin="0,2"/>
                            </Grid>
                            
                            <TextBlock Text="1. Focus a text editor (like Notepad)&#10;2. Press the desired global shortcut key (Win+Shift+F1/F2/F3)&#10;3. The test text will be sent to the focused application" 
                                      Foreground="Gray" FontSize="11" Margin="0,10,0,0" TextWrapping="Wrap"/>
                        </StackPanel>
                    </GroupBox>
                </StackPanel>
            </TabItem>
            
            <TabItem Header="Hotkeys">
                <StackPanel Margin="10">
                    <Label Content="Toggle UI:"/>
                    <TextBox Text="{Binding Settings.Hotkeys.ToggleUi}" 
                            Margin="0,5,0,10"/>
                    
                    <Label Content="Toggle Microphone:"/>
                    <TextBox Text="{Binding Settings.Hotkeys.ToggleMic}" 
                            Margin="0,5,0,10"/>
                </StackPanel>
            </TabItem>
            
            <TabItem Header="Interface">
                <StackPanel Margin="10">
                    <GroupBox Header="Control Window" Margin="0,0,0,15">
                        <StackPanel Margin="10">
                            <TextBlock Text="Reset control window position to default location" 
                                      Margin="0,0,0,10" TextWrapping="Wrap"/>
                            <Button Content="Reset Window Position" 
                                   Command="{Binding ResetWindowPositionCommand}"
                                   Width="150" HorizontalAlignment="Left"/>
                        </StackPanel>
                    </GroupBox>
                    
                    <GroupBox Header="Display Settings" Margin="0,0,0,15">
                        <StackPanel Margin="10">
                            <CheckBox Content="Always show window on primary monitor" 
                                     IsChecked="{Binding Settings.Application.AlwaysOnPrimaryMonitor}" 
                                     Margin="0,5"/>
                            <CheckBox Content="Remember window position" 
                                     IsChecked="{Binding Settings.Application.RememberWindowPosition}" 
                                     Margin="0,5"/>
                        </StackPanel>
                    </GroupBox>
                    
                    <GroupBox Header="Logs &amp; Diagnostics">
                        <StackPanel Margin="10">
                            <TextBlock Text="Open application log files directory" 
                                      Margin="0,0,0,10" TextWrapping="Wrap"/>
                            <Button Content="Open Log Directory" 
                                   Command="{Binding OpenLogDirectoryCommand}"
                                   Width="150" HorizontalAlignment="Left"/>
                        </StackPanel>
                    </GroupBox>
                </StackPanel>
            </TabItem>
            
            <TabItem Header="System">
                <ScrollViewer>
                    <StackPanel Margin="10">
                        <GroupBox Header="Privilege Information" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <TextBlock x:Name="PrivilegeStatusText" 
                                          Text="Checking privilege level..." 
                                          FontWeight="Bold" 
                                          Margin="0,0,0,10"/>
                                
                                <TextBlock x:Name="PrivilegeDescriptionText" 
                                          TextWrapping="Wrap" 
                                          Margin="0,0,0,10"/>
                                
                                <Button x:Name="RestartNormalButton" 
                                       Content="🔄 Restart Without Administrator" 
                                       Width="200" 
                                       HorizontalAlignment="Left" 
                                       Margin="0,5,0,0"
                                       Click="OnRestartNormal"
                                       Visibility="Collapsed"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Input Test Status" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <TextBlock Text="Use these global hotkeys to test text input functionality:" 
                                          Margin="0,0,0,10" TextWrapping="Wrap"/>
                                <TextBox x:Name="SystemTestTextBox" Text="Hello, this is a test from Sttify." 
                                        Margin="0,0,0,10"/>
                                
                                <Grid Margin="0,0,0,10">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Win+Shift+F1:" FontWeight="Bold" Margin="0,2,10,2"/>
                                    <TextBlock Grid.Row="0" Grid.Column="1" Text="Test currently selected output method" Margin="0,2"/>
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Win+Shift+F2:" FontWeight="Bold" Margin="0,2,10,2"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1" Text="Test TSF TIP (direct text insertion)" Margin="0,2"/>
                                    
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Win+Shift+F3:" FontWeight="Bold" Margin="0,2,10,2"/>
                                    <TextBlock Grid.Row="2" Grid.Column="1" Text="Test SendInput (virtual keyboard)" Margin="0,2"/>
                                    
                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="📝 Tip:" FontWeight="Bold" Margin="0,10,10,2"/>
                                    <TextBlock Grid.Row="3" Grid.Column="1" Text="Focus on a text editor (like Notepad) before pressing hotkeys" Margin="0,10,0,2" TextWrapping="Wrap"/>
                                </Grid>
                                
                                <Button Content="🗒️ Open Notepad for Testing" 
                                       Click="OnOpenNotepad"
                                       Width="200" 
                                       HorizontalAlignment="Left" 
                                       Margin="0,5,0,0"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
        
        <!-- Buttons -->
        <StackPanel Grid.Row="2" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right" 
                    Margin="0,10,0,0">
            <Button Content="Reset to Defaults" 
                   Command="{Binding ResetToDefaultsCommand}" 
                   Width="120" Margin="0,0,10,0"/>
            <Button Content="Cancel" Width="80" Margin="0,0,10,0" Click="OnCancel"/>
            <Button Content="OK" Width="80" IsDefault="True" Click="OnOK"/>
        </StackPanel>
    </Grid>
</Window>